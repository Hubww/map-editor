(function(t){function n(n){for(var o,a,s=n[0],c=n[1],l=n[2],u=0,d=[];u<s.length;u++)a=s[u],r[a]&&d.push(r[a][0]),r[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);h&&h(n);while(d.length)d.shift()();return i.push.apply(i,l||[]),e()}function e(){for(var t,n=0;n<i.length;n++){for(var e=i[n],o=!0,a=1;a<e.length;a++){var s=e[a];0!==r[s]&&(o=!1)}o&&(i.splice(n--,1),t=c(c.s=e[0]))}return t}var o={},a={app:0},r={app:0},i=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-19300532":"90dbb3f6","chunk-223d0da7":"1aa8de9c","chunk-804ffc60":"96cefe8d","chunk-af471872":"535a8c81"}[t]+".js"}function c(n){if(o[n])return o[n].exports;var e=o[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,c),e.l=!0,e.exports}c.e=function(t){var n=[],e={"chunk-19300532":1,"chunk-223d0da7":1,"chunk-804ffc60":1,"chunk-af471872":1};a[t]?n.push(a[t]):0!==a[t]&&e[t]&&n.push(a[t]=new Promise(function(n,e){for(var o="css/"+({}[t]||t)+"."+{"chunk-19300532":"1fbef7ad","chunk-223d0da7":"25840469","chunk-804ffc60":"11c49fcf","chunk-af471872":"61431929"}[t]+".css",a=c.p+o,r=document.getElementsByTagName("link"),i=0;i<r.length;i++){var s=r[i],l=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(l===o||l===a))return n()}var u=document.getElementsByTagName("style");for(i=0;i<u.length;i++){s=u[i],l=s.getAttribute("data-href");if(l===o||l===a)return n()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=n,d.onerror=function(n){var o=n&&n.target&&n.target.src||a,r=new Error("Loading CSS chunk "+t+" failed.\n("+o+")");r.request=o,e(r)},d.href=a;var h=document.getElementsByTagName("head")[0];h.appendChild(d)}).then(function(){a[t]=0}));var o=r[t];if(0!==o)if(o)n.push(o[2]);else{var i=new Promise(function(n,e){o=r[t]=[n,e]});n.push(o[2]=i);var l,u=document.getElementsByTagName("head")[0],d=document.createElement("script");d.charset="utf-8",d.timeout=120,c.nc&&d.setAttribute("nonce",c.nc),d.src=s(t),l=function(n){d.onerror=d.onload=null,clearTimeout(h);var e=r[t];if(0!==e){if(e){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src,i=new Error("Loading chunk "+t+" failed.\n("+o+": "+a+")");i.type=o,i.request=a,e[1](i)}r[t]=void 0}};var h=setTimeout(function(){l({type:"timeout",target:d})},12e4);d.onerror=d.onload=l,u.appendChild(d)}return Promise.all(n)},c.m=t,c.c=o,c.d=function(t,n,e){c.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,n){if(1&n&&(t=c(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(c.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)c.d(e,o,function(n){return t[n]}.bind(null,o));return e},c.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(n,"a",n),n},c.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},c.p="/map-editor/",c.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=n,l=l.slice();for(var d=0;d<l.length;d++)n(l[d]);var h=u;i.push([0,"chunk-vendors"]),e()})({0:function(t,n,e){t.exports=e("56d7")},"034f":function(t,n,e){"use strict";var o=e("ec8c"),a=e.n(o);a.a},"3da7":function(t,n,e){"use strict";e.d(n,"d",function(){return r}),e.d(n,"a",function(){return i}),e.d(n,"e",function(){return s}),e.d(n,"b",function(){return c}),e.d(n,"c",function(){return l});e("aba3"),e("25d7"),e("2b1f"),e("bc72");var o=e("504b"),a=e("329b"),r=function(t,n){var e=new FileReader;e.readAsText(t),e.onload=function(){"function"===typeof n&&n(this.result)}},i=function t(n){if(!n)return n;var e=n instanceof Array?[]:{};for(var a in n)e[a]="object"===Object(o["a"])(n[a])?t(n[a]):n[a];return e},s=function(t,n){if(void 0===n){var e=sessionStorage.getItem(t);return e&&0===e.indexOf("autostringify-")?JSON.parse(e.split("autostringify-")[1]):e}return("object"===Object(o["a"])(n)||Array.isArray(n))&&(n="autostringify-"+JSON.stringify(n)),sessionStorage.setItem(t,n)},c=function(t,n){var e=[],o=/<polygon([^<]+)\/>/g,r=t.match(o);r.length||a["default"].$notify({title:"警告",message:"svg文件异常",type:"warning"}),r.forEach(function(t){var n=/points="([^"]+)"/g,o=/title="([^"]+)"/g,a=/data-x="([^"]+)"/g,r=/data-y="([^"]+)"/g,i=n.exec(t),s=o.exec(t),c=a.exec(t),l=r.exec(t);if(null===i)return new Error('polygon without prop "points"');i=i[1].trim().split(" ").map(function(t){return t.trim().replace(/\\r\\n\\t/g,"")}).join(" ");var u=i.trim().split(" ").map(function(t){return t.trim().split(",").join(" ")});if(s=null===s?"未命名":s[1],null===c||null===l){var d,h,p,f,g=[],m=[];u.forEach(function(t){var n=t.split(" ");g.push(n[0]),m.push(n[1])}),d=Math.max.apply(null,g),h=Math.max.apply(null,m),p=Math.min.apply(null,g),f=Math.min.apply(null,m),u=u.map(function(t){return t=t.split(" ").map(function(t){return t+"px"}),t.join(" ")}),c=parseInt((d+p)/2),l=parseInt((h+f)/2)}else c=c[1],l=l[1];e.push({points:i,attrDataX:c,attrDataY:l,attrTitle:s,connectPoint:{}})}),"function"===typeof n&&n(e)},l=function(t,n){for(var e=null,o=0;o<n.length;o++){var a=n[o];if(a.x===t.x&&a.y===t.y){e=o;break}}return e};new a["default"]},"56d7":function(t,n,e){"use strict";e.r(n);e("3a0f"),e("a3a3"),e("4d0b");var o=e("329b"),a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"flex-row",staticStyle:{overflow:"auto"},attrs:{id:"app"}},[e("div",{staticClass:"pr area-wrap oh"},[e("div",{staticClass:"layer",attrs:{id:"svgElements"}},[e("svg",{attrs:{width:"1000",height:"1000",xmlns:"http://www.w3.org/2000/svg"},on:{click:function(n){return n.target!==n.currentTarget?null:t.resetSvg(n)}}},[t._l(t.polygons,function(n,o){return[e("polygon",{key:"polygon"+o,class:{isBlock:n.block,svgArea:!0},style:n.type,attrs:{points:n.points,"data-x":n.attrDataX,"data-y":n.attrDataY,title:n.attrTitle},on:{click:function(e){t.clickElement(e,n)}}})]})],2)]),e("div",{staticClass:"layer mapFloat"},[t._l(t.polygons,function(n,o){return n.block?t._e():[e("span",{key:"float"+o,staticClass:"_title",style:{left:n.attrDataX+"px",top:n.attrDataY+"px"}},[t._v(t._s(n.attrTitle))])]})],2),"路径绘制"===t.mode||t.$root.cachePointMode?e("div",{staticClass:"layer svgPath"},[e("div",{staticClass:"layer drawPath",on:{click:t.drawPath}},t._l(t.roads,function(n,o){return e("div",{key:"showPath"+o},t._l(n,function(n,a){return e("div",{key:"showPathPoint"+a,staticClass:"drawPoint",class:{active:!!n.active},style:{left:n.x+"px",top:n.y+"px"},attrs:{title:"路径"+(o+1)+" "+n.x+","+n.y},on:{click:function(e){e.stopPropagation(),t.clickPoint(n,o)},mousedown:function(e){t.startPoint(e,n)}}})}))})),e("svg",{attrs:{width:"1000",height:"1000",xmlns:"http://www.w3.org/2000/svg"}},t._l(t.roads,function(n,o){return e("polyline",{key:"showPath"+o,class:{editingPath:!0,active:o===t.$root.currentEditingPathIndex},attrs:{points:n.map(function(t){return t.x+","+t.y}).join(" ")}})}))]):t._e(),e("typemarks")],1),e("div",{staticClass:"flex-1",staticStyle:{margin:"20px"}},[e("importer",{on:{importSvg:t.importSvg,importMap:t.importMap,importPath:t.importPath}}),e("el-row",{attrs:{gutter:8}},[e("el-col",{attrs:{span:8}},[e("el-radio-group",{attrs:{size:"small"},model:{value:t.mode,callback:function(n){t.mode=n},expression:"mode"}},[e("el-radio-button",{attrs:{label:"编辑地图"}}),e("el-radio-button",{attrs:{label:"路径绘制"}})],1),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning",size:"small"},on:{click:t.useTest}},[t._v("体验数据")])],1),e("el-col",{staticClass:"group-bar-right",attrs:{span:16}},[e("el-button",{attrs:{icon:"el-icon-download",size:"small"}},[e("a",{attrs:{id:"mapDataDownload",download:"map.json",target:"_blank"}},[t._v("保存map.json")])]),e("el-button",{attrs:{icon:"el-icon-download",size:"small",disabled:!t.roads.length}},[e("a",{attrs:{id:"pathDataDownload",download:"path.json",target:"_blank"}},[t._v("保存path.json")])]),e("el-button",{attrs:{type:"danger",icon:"el-icon-warning",size:"small",disabled:!t.polygonsBackup||!t.roadsBackup},on:{click:t.resetData}},[t._v("恢复数据")]),e("el-button",{attrs:{type:"danger",icon:"el-icon-warning",size:"small"},on:{click:t.clearData}},[t._v("清空数据")])],1)],1),e("mapediter",{directives:[{name:"show",rawName:"v-show",value:"编辑地图"===t.mode,expression:"mode==='编辑地图'"}],attrs:{polygon:t.currentPolygon}}),e("roadsediter",{directives:[{name:"show",rawName:"v-show",value:"路径绘制"===t.mode&&!t.$root.cachePointMode,expression:"mode==='路径绘制' && !$root.cachePointMode"}],attrs:{roads:t.roads,roadsCurrentShow:t.roadsCurrentShow},on:{savePath:t.savePath,update:t.updatePath}})],1)])},r=[],i=(e("25d7"),e("3da7")),s=[{title:"餐饮",fill:"#f2dc66",stroke:"#cebd63"},{title:"服装",fill:"#fece8b",stroke:"#e0b170"},{title:"百货",fill:"#eacf98",stroke:"#d9b87a"},{title:"娱乐",fill:"#87A765",stroke:"#7eb543"},{title:"美容美发",fill:"#e89bb6",stroke:"#ce7795"},{title:"电子数码",fill:"#94cefd",stroke:"#8abbe3"}],c=e("7f43"),l=e.n(c),u="/map-editor/",d=l.a.create({baseURL:u,timeout:1e4}),h=d,p={},f=function(t){var n=p.point;if(n){var e=t.clientX-p.x,o=t.clientY-p.y;0===e&&0===o||(n.isMoving=!0,n.x+=e,n.y+=o,p.x=t.clientX,p.y=t.clientY)}},g=function t(){document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",t)},m={components:{importer:function(t){return e.e("chunk-19300532").then(function(){var n=[e("1d39")];t.apply(null,n)}.bind(this)).catch(e.oe)},typemarks:function(t){return e.e("chunk-223d0da7").then(function(){var n=[e("1b91")];t.apply(null,n)}.bind(this)).catch(e.oe)},mapediter:function(t){return e.e("chunk-af471872").then(function(){var n=[e("1f59")];t.apply(null,n)}.bind(this)).catch(e.oe)},roadsediter:function(t){return e.e("chunk-804ffc60").then(function(){var n=[e("6d03")];t.apply(null,n)}.bind(this)).catch(e.oe)}},data:function(){return{winHeight:null,mainDom:null,mapDataDownloadDom:null,pathDataDownloadDom:null,roadsBackup:null,polygonsBackup:null,polygons:[],roads:[],currentPolygon:{},mode:"编辑地图",roadsCurrentShow:void 0}},watch:{mode:function(){this.resetSvg()},polygons:{handler:function(t){var n=this;if(i["e"]("editing-polygons",t),this.mapDataDownloadDom){var e=this.polygons.map(function(t,e){return 0===e?"["+JSON.stringify(t)+",":e===n.polygons.length-1?JSON.stringify(t)+"]":JSON.stringify(t)+","}),o=new Blob(e,{type:"application/json"});this.mapDataDownloadDom.href=window.URL.createObjectURL(o)}},deep:!0}},computed:{currentPath:function(){if(Array.isArray(this.roads)&&null!==this.$root.currentEditingPathIndex)return this.roads[this.$root.currentEditingPathIndex]}},methods:{useTest:function(){var t=this;h.get("/map.json").then(function(n){t.importMap(n.data)}),h.get("/path.json").then(function(n){t.importPath(n.data)})},startPoint:function(t,n){p={x:t.clientX,y:t.clientY,point:n,pointCache:i["a"](n)},document.addEventListener("mousemove",f),document.addEventListener("mouseup",g)},clickPoint:function(t,n){if(t.isMoving){var e=p.point,o=p.pointCache;o&&o.connect&&this.roads.forEach(function(t){t.forEach(function(t){t.connect&&t.x===o.x&&t.y===o.y&&(t.x=e.x,t.y=e.y)})}),p={},delete t.isMoving}else if(this.$root.cachePointMode){this.currentPolygon.connectPoint=t,t.connectBuildings||(t.connectBuildings=[]);var a=t.connectBuildings.indexOf(this.currentPolygon.attrTitle);a<0&&t.connectBuildings.push(this.currentPolygon.attrTitle),this.$root.cachePointMode=!1,this.savePath()}else{null===this.$root.currentEditingPathIndex&&(this.$root.currentEditingPathIndex=n);var r=this.currentPath&&i["c"](t,this.currentPath);t.active?this.roadsCurrentShow=void 0:null!==r?this.roadsCurrentShow=t:(this.roads[this.$root.currentEditingPathIndex].push(t),t.connect=!0)}},breakConnect:function(){var t=this.currentPolygon.connectPoint.connectBuildings.indexOf(this.currentPolygon.attrTitle);t>=0&&this.currentPolygon.connectPoint.connectBuildings.splice(t,1),delete this.currentPolygon.connectPoint},drawPath:function(t){p&&p.point?p={}:(null===this.$root.currentEditingPathIndex&&(this.roads.push([]),this.$root.currentEditingPathIndex=this.roads.length-1),this.roads[this.$root.currentEditingPathIndex].push({x:t.offsetX,y:t.offsetY}))},savePath:function(){var t=this;if(i["e"]("editing-roads",this.roads),this.pathDataDownloadDom){var n=this.roads.map(function(n,e){return 0===e?"["+JSON.stringify(n)+",":e===t.roads.length-1?JSON.stringify(n)+"]":JSON.stringify(n)+","}),e=new Blob(n,{type:"application/json"});this.pathDataDownloadDom.href=window.URL.createObjectURL(e)}},updatePath:function(){var t=this;this.$nextTick(function(){t.$forceUpdate()})},unchoosePath:function(){this.$root.currentEditingPathIndex=null},resetData:function(){this.resetSvg(),this.unchoosePath(),Array.isArray(this.polygonsBackup)&&(this.polygons=i["a"](this.polygonsBackup)),Array.isArray(this.roadsBackup)&&(this.roads=i["a"](this.roadsBackup))},clearData:function(){this.reset(),this.resetSvg(),this.unchoosePath(),this.polygonsBackup=null,this.roadsBackup=null,this.polygons=[],this.roads=[]},resetSvg:function(){if(this.currentPolygon={},this.mainDom){var t=this.mainDom.querySelectorAll("polygon.active");t.forEach(function(t){t.classList.remove("active")})}},clickElement:function(t,n){this.resetSvg(),t.target.classList.add("active"),this.currentPolygon=n},reset:function(){this.currentPolygon={},this.$root.currentEditingPathIndex=null,this.mode="编辑地图",this.roadsCurrentShow=void 0},importSvg:function(t){this.polygonsBackup=t,this.polygons=i["a"](this.polygonsBackup)},importMap:function(t){this.reset(),t.forEach(function(t){t.connectPoint||(t.connectPoint={})}),this.polygonsBackup=t,this.polygons=i["a"](this.polygonsBackup),i["e"]("editing-polygons",t)},importPath:function(t){this.reset(),this.roadsBackup=t,this.roads=i["a"](this.roadsBackup),i["e"]("editing-roads",this.roads)}},created:function(){var t=this,n=i["e"]("editing-polygons");n&&(this.polygonsBackup=n,this.polygons=i["a"](this.polygonsBackup));var e=i["e"]("editing-roads");e&&(this.roadsBackup=e,this.roads=i["a"](this.roadsBackup),this.$nextTick(function(){t.savePath()})),this.$root.buildingTypes=s},mounted:function(){this.mainDom=document.getElementById("svgElements"),this.mapDataDownloadDom=document.getElementById("mapDataDownload"),this.pathDataDownloadDom=document.getElementById("pathDataDownload")}},y=m,v=(e("034f"),e("048f")),w=Object(v["a"])(y,a,r,!1,null,null,null);w.options.__file="App.vue";var b=w.exports,P=e("beff"),k=e.n(P);e("f513");o["default"].use(k.a),o["default"].config.productionTip=!1,new o["default"]({data:function(){return{cachePointMode:!1,buildingTypes:[],currentEditingPathIndex:null}},render:function(t){return t(b)}}).$mount("#app")},ec8c:function(t,n,e){}});
//# sourceMappingURL=app.66d84b98.js.map