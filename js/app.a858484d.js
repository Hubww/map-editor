(function(t){function n(n){for(var o,a,s=n[0],c=n[1],l=n[2],u=0,d=[];u<s.length;u++)a=s[u],i[a]&&d.push(i[a][0]),i[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);h&&h(n);while(d.length)d.shift()();return r.push.apply(r,l||[]),e()}function e(){for(var t,n=0;n<r.length;n++){for(var e=r[n],o=!0,a=1;a<e.length;a++){var s=e[a];0!==i[s]&&(o=!1)}o&&(r.splice(n--,1),t=c(c.s=e[0]))}return t}var o={},a={app:0},i={app:0},r=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-2d0b6caf":"6a9dbb1a","chunk-37cc58a9":"c53354b6","chunk-60cf599a":"390a25ac","chunk-70c562fe":"ee23ee3b"}[t]+".js"}function c(n){if(o[n])return o[n].exports;var e=o[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,c),e.l=!0,e.exports}c.e=function(t){var n=[],e={"chunk-37cc58a9":1,"chunk-60cf599a":1,"chunk-70c562fe":1};a[t]?n.push(a[t]):0!==a[t]&&e[t]&&n.push(a[t]=new Promise(function(n,e){for(var o="css/"+({}[t]||t)+"."+{"chunk-2d0b6caf":"31d6cfe0","chunk-37cc58a9":"11c49fcf","chunk-60cf599a":"e2f5547d","chunk-70c562fe":"81528045"}[t]+".css",i=c.p+o,r=document.getElementsByTagName("link"),s=0;s<r.length;s++){var l=r[s],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===o||u===i))return n()}var d=document.getElementsByTagName("style");for(s=0;s<d.length;s++){l=d[s],u=l.getAttribute("data-href");if(u===o||u===i)return n()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=n,h.onerror=function(n){var o=n&&n.target&&n.target.src||i,r=new Error("Loading CSS chunk "+t+" failed.\n("+o+")");r.request=o,delete a[t],h.parentNode.removeChild(h),e(r)},h.href=i;var p=document.getElementsByTagName("head")[0];p.appendChild(h)}).then(function(){a[t]=0}));var o=i[t];if(0!==o)if(o)n.push(o[2]);else{var r=new Promise(function(n,e){o=i[t]=[n,e]});n.push(o[2]=r);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=s(t),l=function(n){u.onerror=u.onload=null,clearTimeout(d);var e=i[t];if(0!==e){if(e){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src,r=new Error("Loading chunk "+t+" failed.\n("+o+": "+a+")");r.type=o,r.request=a,e[1](r)}i[t]=void 0}};var d=setTimeout(function(){l({type:"timeout",target:u})},12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(n)},c.m=t,c.c=o,c.d=function(t,n,e){c.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,n){if(1&n&&(t=c(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(c.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)c.d(e,o,function(n){return t[n]}.bind(null,o));return e},c.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(n,"a",n),n},c.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},c.p="/map-editor/",c.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=n,l=l.slice();for(var d=0;d<l.length;d++)n(l[d]);var h=u;r.push([0,"chunk-vendors"]),e()})({0:function(t,n,e){t.exports=e("56d7")},"034f":function(t,n,e){"use strict";var o=e("64a9"),a=e.n(o);a.a},"3da7":function(t,n,e){"use strict";e.d(n,"d",function(){return d}),e.d(n,"a",function(){return h}),e.d(n,"e",function(){return p}),e.d(n,"b",function(){return f}),e.d(n,"c",function(){return g});var o=e("e814"),a=e.n(o),i=(e("a481"),e("ac6a"),e("4917"),e("f499")),r=e.n(i),s=e("a745"),c=e.n(s),l=(e("28a5"),e("7618")),u=e("2b0e"),d=function(t,n){var e=new FileReader;e.readAsText(t),e.onload=function(){"function"===typeof n&&n(this.result)}},h=function t(n){if(!n)return n;var e=n instanceof Array?[]:{};for(var o in n)e[o]="object"===Object(l["a"])(n[o])?t(n[o]):n[o];return e},p=function(t,n){if(void 0===n){var e=sessionStorage.getItem(t);return e&&0===e.indexOf("autostringify-")?JSON.parse(e.split("autostringify-")[1]):e}return("object"===Object(l["a"])(n)||c()(n))&&(n="autostringify-"+r()(n)),sessionStorage.setItem(t,n)},f=function(t,n){var e=[],o=/<polygon([^<]+)\/>/g,i=t.match(o);i.length||u["default"].$notify({title:"警告",message:"svg文件异常",type:"warning"}),i.forEach(function(t){var n=/points="([^"]+)"/g,o=/title="([^"]+)"/g,i=/data-x="([^"]+)"/g,r=/data-y="([^"]+)"/g,s=n.exec(t),c=o.exec(t),l=i.exec(t),u=r.exec(t);if(null===s)return new Error('polygon without prop "points"');s=s[1].trim().split(" ").map(function(t){return t.trim().replace(/\\r\\n\\t/g,"")}).join(" ");var d=s.trim().split(" ").map(function(t){return t.trim().split(",").join(" ")});if(c=null===c?"未命名":c[1],null===l||null===u){var h,p,f,g,m=[],v=[];d.forEach(function(t){var n=t.split(" ");m.push(n[0]),v.push(n[1])}),h=Math.max.apply(null,m),p=Math.max.apply(null,v),f=Math.min.apply(null,m),g=Math.min.apply(null,v),d=d.map(function(t){return t=t.split(" ").map(function(t){return t+"px"}),t.join(" ")}),l=a()((h+f)/2),u=a()((p+g)/2)}else l=l[1],u=u[1];e.push({points:s,attrDataX:l,attrDataY:u,attrTitle:c,connectPoint:{}})}),"function"===typeof n&&n(e)},g=function(t,n){for(var e=null,o=0;o<n.length;o++){var a=n[o];if(a.x===t.x&&a.y===t.y){e=o;break}}return e};new u["default"]},"56d7":function(t,n,e){"use strict";e.r(n);e("cadf"),e("551c"),e("097d");var o=e("2b0e"),a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"flex-row",staticStyle:{overflow:"auto"},attrs:{id:"app"}},[e("div",{staticClass:"pr area-wrap oh"},[e("div",{staticClass:"layer",attrs:{id:"svgElements"}},[e("svg",{attrs:{width:"1000",height:"1000",xmlns:"http://www.w3.org/2000/svg"},on:{click:function(n){return n.target!==n.currentTarget?null:t.resetSvg(n)}}},[t._l(t.polygons,function(n,o){return[e("polygon",{key:"polygon"+o,class:{isBlock:n.block,svgArea:!0},style:n.type,attrs:{points:n.points,"data-x":n.attrDataX,"data-y":n.attrDataY,title:n.attrTitle},on:{click:function(e){t.clickElement(e,n)}}})]})],2)]),e("div",{staticClass:"layer mapFloat"},[t._l(t.polygons,function(n,o){return n.block?t._e():[e("span",{key:"float"+o,staticClass:"_title",style:{left:n.attrDataX+"px",top:n.attrDataY+"px"}},[t._v(t._s(n.attrTitle))])]})],2),"路径绘制"===t.mode||t.$root.cachePointMode?e("div",{staticClass:"layer svgPath"},[e("div",{staticClass:"layer drawPath",on:{click:t.drawPath}},t._l(t.roads,function(n,o){return e("div",{key:"showPath"+o},t._l(n,function(n,a){return e("div",{key:"showPathPoint"+a,staticClass:"drawPoint",class:{active:!!n.active},style:{left:n.x+"px",top:n.y+"px"},attrs:{title:"路径"+(o+1)+" "+n.x+","+n.y},on:{click:function(e){e.stopPropagation(),t.clickPoint(n,o)},mousedown:function(e){t.startPoint(e,n)}}})}),0)}),0),e("svg",{attrs:{width:"1000",height:"1000",xmlns:"http://www.w3.org/2000/svg"}},t._l(t.roads,function(n,o){return e("polyline",{key:"showPath"+o,class:{editingPath:!0,active:o===t.$root.currentEditingPathIndex},attrs:{points:n.map(function(t){return t.x+","+t.y}).join(" ")}})}),0)]):t._e(),e("typemarks")],1),e("div",{staticClass:"flex-1",staticStyle:{margin:"20px"}},[e("importer",{on:{importSvg:t.importSvg,importMap:t.importMap,importPath:t.importPath}}),e("el-row",{attrs:{gutter:8}},[e("el-col",{attrs:{span:8}},[e("el-radio-group",{attrs:{size:"small"},model:{value:t.mode,callback:function(n){t.mode=n},expression:"mode"}},[e("el-radio-button",{attrs:{label:"编辑地图"}}),e("el-radio-button",{attrs:{label:"路径绘制"}})],1),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning",size:"small"},on:{click:t.useTest}},[t._v("体验数据")])],1),e("el-col",{staticClass:"group-bar-right",attrs:{span:16}},[e("el-button",{attrs:{icon:"el-icon-download",size:"small"}},[e("a",{attrs:{id:"mapDataDownload",download:"map.json",target:"_blank"}},[t._v("保存map.json")])]),e("el-button",{attrs:{icon:"el-icon-download",size:"small",disabled:!t.roads.length}},[e("a",{attrs:{id:"pathDataDownload",download:"path.json",target:"_blank"}},[t._v("保存path.json")])]),e("el-button",{attrs:{type:"danger",icon:"el-icon-warning",size:"small",disabled:!t.polygonsBackup||!t.roadsBackup},on:{click:t.resetData}},[t._v("恢复数据")]),e("el-button",{attrs:{type:"danger",icon:"el-icon-warning",size:"small"},on:{click:t.clearData}},[t._v("清空数据")])],1)],1),e("mapediter",{directives:[{name:"show",rawName:"v-show",value:"编辑地图"===t.mode,expression:"mode==='编辑地图'"}],attrs:{polygon:t.currentPolygon}}),e("roadsediter",{directives:[{name:"show",rawName:"v-show",value:"路径绘制"===t.mode&&!t.$root.cachePointMode,expression:"mode==='路径绘制' && !$root.cachePointMode"}],attrs:{roads:t.roads,roadsCurrentShow:t.roadsCurrentShow},on:{savePath:t.savePath,update:t.updatePath}})],1)])},i=[],r=(e("ac6a"),e("a745")),s=e.n(r),c=e("f499"),l=e.n(c),u=e("3da7"),d=[{title:"餐饮",fill:"#f2dc66",stroke:"#cebd63"},{title:"服装",fill:"#fece8b",stroke:"#e0b170"},{title:"百货",fill:"#eacf98",stroke:"#d9b87a"},{title:"娱乐",fill:"#87A765",stroke:"#7eb543"},{title:"美容美发",fill:"#e89bb6",stroke:"#ce7795"},{title:"电子数码",fill:"#94cefd",stroke:"#8abbe3"}],h=e("bc3a"),p=e.n(h),f="/map-editor/",g=p.a.create({baseURL:f,timeout:1e4}),m=g,v={},y=function(t){var n=v.point;if(n){var e=t.clientX-v.x,o=t.clientY-v.y;0===e&&0===o||(n.isMoving=!0,n.x+=e,n.y+=o,v.x=t.clientX,v.y=t.clientY)}},w=function t(){document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",t)},P={components:{importer:function(t){return e.e("chunk-60cf599a").then(function(){var n=[e("1d39")];t.apply(null,n)}.bind(this)).catch(e.oe)},typemarks:function(t){return e.e("chunk-70c562fe").then(function(){var n=[e("1b91")];t.apply(null,n)}.bind(this)).catch(e.oe)},mapediter:function(t){return e.e("chunk-2d0b6caf").then(function(){var n=[e("1f59")];t.apply(null,n)}.bind(this)).catch(e.oe)},roadsediter:function(t){return e.e("chunk-37cc58a9").then(function(){var n=[e("6d03")];t.apply(null,n)}.bind(this)).catch(e.oe)}},data:function(){return{winHeight:null,mainDom:null,mapDataDownloadDom:null,pathDataDownloadDom:null,roadsBackup:null,polygonsBackup:null,polygons:[],roads:[],currentPolygon:{},mode:"编辑地图",roadsCurrentShow:void 0}},watch:{mode:function(){this.resetSvg()},polygons:{handler:function(t){var n=this;if(u["e"]("editing-polygons",t),this.mapDataDownloadDom){var e=this.polygons.map(function(t,e){return 0===e?"["+l()(t)+",":e===n.polygons.length-1?l()(t)+"]":l()(t)+","}),o=new Blob(e,{type:"application/json"});this.mapDataDownloadDom.href=window.URL.createObjectURL(o)}},deep:!0}},computed:{currentPath:function(){if(s()(this.roads)&&null!==this.$root.currentEditingPathIndex)return this.roads[this.$root.currentEditingPathIndex]}},methods:{useTest:function(){var t=this;m.get("/map.json").then(function(n){t.importMap(n.data)}),m.get("/path.json").then(function(n){t.importPath(n.data)})},startPoint:function(t,n){v={x:t.clientX,y:t.clientY,point:n,pointCache:u["a"](n)},document.addEventListener("mousemove",y),document.addEventListener("mouseup",w)},clickPoint:function(t,n){if(t.isMoving){var e=v.point,o=v.pointCache;o&&o.connect&&this.roads.forEach(function(t){t.forEach(function(t){t.connect&&t.x===o.x&&t.y===o.y&&(t.x=e.x,t.y=e.y)})}),v={},delete t.isMoving}else if(this.$root.cachePointMode){this.currentPolygon.connectPoint=t,t.connectBuildings||(t.connectBuildings=[]);var a=t.connectBuildings.indexOf(this.currentPolygon.attrTitle);a<0&&t.connectBuildings.push(this.currentPolygon.attrTitle),this.$root.cachePointMode=!1,this.savePath()}else{null===this.$root.currentEditingPathIndex&&(this.$root.currentEditingPathIndex=n);var i=this.currentPath&&u["c"](t,this.currentPath);t.active?this.roadsCurrentShow=void 0:null!==i?this.roadsCurrentShow=t:(this.roads[this.$root.currentEditingPathIndex].push(t),t.connect=!0)}},breakConnect:function(){var t=this.currentPolygon.connectPoint.connectBuildings.indexOf(this.currentPolygon.attrTitle);t>=0&&this.currentPolygon.connectPoint.connectBuildings.splice(t,1),delete this.currentPolygon.connectPoint},drawPath:function(t){v&&v.point?v={}:(null===this.$root.currentEditingPathIndex&&(this.roads.push([]),this.$root.currentEditingPathIndex=this.roads.length-1),this.roads[this.$root.currentEditingPathIndex].push({x:t.offsetX,y:t.offsetY}))},savePath:function(){var t=this;if(u["e"]("editing-roads",this.roads),this.pathDataDownloadDom){var n=this.roads.map(function(n,e){return 0===e?"["+l()(n)+",":e===t.roads.length-1?l()(n)+"]":l()(n)+","}),e=new Blob(n,{type:"application/json"});this.pathDataDownloadDom.href=window.URL.createObjectURL(e)}},updatePath:function(){var t=this;this.$nextTick(function(){t.$forceUpdate()})},unchoosePath:function(){this.$root.currentEditingPathIndex=null},resetData:function(){this.resetSvg(),this.unchoosePath(),s()(this.polygonsBackup)&&(this.polygons=u["a"](this.polygonsBackup)),s()(this.roadsBackup)&&(this.roads=u["a"](this.roadsBackup))},clearData:function(){this.reset(),this.resetSvg(),this.unchoosePath(),this.polygonsBackup=null,this.roadsBackup=null,this.polygons=[],this.roads=[]},resetSvg:function(){if(this.currentPolygon={},this.mainDom){var t=this.mainDom.querySelectorAll("polygon.active");t.forEach(function(t){t.classList.remove("active")})}},clickElement:function(t,n){this.resetSvg(),t.target.classList.add("active"),this.currentPolygon=n},reset:function(){this.currentPolygon={},this.$root.currentEditingPathIndex=null,this.mode="编辑地图",this.roadsCurrentShow=void 0},importSvg:function(t){this.polygonsBackup=t,this.polygons=u["a"](this.polygonsBackup)},importMap:function(t){this.reset(),t.forEach(function(t){t.connectPoint||(t.connectPoint={})}),this.polygonsBackup=t,this.polygons=u["a"](this.polygonsBackup),u["e"]("editing-polygons",t)},importPath:function(t){this.reset(),this.roadsBackup=t,this.roads=u["a"](this.roadsBackup),u["e"]("editing-roads",this.roads)}},created:function(){var t=this,n=u["e"]("editing-polygons");n&&(this.polygonsBackup=n,this.polygons=u["a"](this.polygonsBackup));var e=u["e"]("editing-roads");e&&(this.roadsBackup=e,this.roads=u["a"](this.roadsBackup),this.$nextTick(function(){t.savePath()})),this.$root.buildingTypes=d},mounted:function(){this.mainDom=document.getElementById("svgElements"),this.mapDataDownloadDom=document.getElementById("mapDataDownload"),this.pathDataDownloadDom=document.getElementById("pathDataDownload")}},b=P,k=(e("034f"),e("2877")),x=Object(k["a"])(b,a,i,!1,null,null,null);x.options.__file="App.vue";var D=x.exports,E=e("5c96"),B=e.n(E);e("0fae");o["default"].use(B.a),o["default"].config.productionTip=!1,new o["default"]({data:function(){return{cachePointMode:!1,buildingTypes:[],currentEditingPathIndex:null}},render:function(t){return t(D)}}).$mount("#app")},"64a9":function(t,n,e){}});